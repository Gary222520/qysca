package nju.edu.cn.qysca.dao.vulnerability;

import nju.edu.cn.qysca.domain.vulnerability.dos.CveDO;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface CveDao extends JpaRepository<CveDO,String> {
    /**
     * 根据cve id查找漏洞信息
     * @param cveId cve id
     * @return 漏洞信息
     */
    CveDO findOneByCveId(String cveId);

    /**
     * 分页查询漏洞信息列表
     * @param vulnerabilities 漏洞id列表
     * @param pageable 开启分页
     * @return 漏洞信息列表分页
     */
    @Query("select c from CveDO c where c.cveId in (:vulnerabilities) order by c.cveId desc")
    Page<CveDO> getCveList(@Param("vulnerabilities") List<String> vulnerabilities, Pageable pageable);

    /**
     * 漏洞库分页查询漏洞信息
     * @param cveId 漏洞Id
     * @param pageable 开启分页
     * @return Page<CveDO> 漏洞信息列表分页
     */
    @Query("select c from CveDO c where (:cveId = '' or c.cveId = :cveId) order by c.cveId desc")
    Page<CveDO> getCvePage(@Param("cveId") String cveId, Pageable pageable);
}
