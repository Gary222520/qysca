package nju.edu.cn.qysca.controller.vulnerability;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import nju.edu.cn.qysca.controller.ResponseMsg;
import nju.edu.cn.qysca.domain.license.dtos.LicenseBriefDTO;
import nju.edu.cn.qysca.domain.vulnerability.dos.CveDO;
import nju.edu.cn.qysca.domain.vulnerability.dos.CweDO;
import nju.edu.cn.qysca.domain.vulnerability.dtos.CveBriefDTO;
import nju.edu.cn.qysca.service.vulnerability.VulnerabilityService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.web.bind.annotation.*;

@Api("漏洞相关接口")
@RestController
@RequestMapping("qysca/vulnerability")
public class vulnerabilityController {

    @Autowired
    private VulnerabilityService vulnerabilityService;

    @ApiOperation("获取某个应用的漏洞列表")
    @GetMapping("/getCveList")
    public ResponseMsg<Page<CveBriefDTO>> getCveList(@RequestParam String name, @RequestParam String version, @RequestParam int page, @RequestParam int size){
        return new ResponseMsg<>(vulnerabilityService.getCveList(name, version, page, size));
    }

    @ApiOperation("在某个应用中增加漏洞信息")
    @PostMapping("/addAppVulnerability")
    public ResponseMsg<Boolean> addAppVulnerability(@RequestParam String name, @RequestParam String version, @RequestParam String vulName){
        return new ResponseMsg<>(vulnerabilityService.addAppVulnerability(name, version, vulName));
    }

    @ApiOperation("在某个应用中删除漏洞信息")
    @PostMapping("/deleteAppVulnerability")
    public ResponseMsg<Boolean> deleteAppVulnerability(@RequestParam String name, @RequestParam String version, @RequestParam String vulName){
        return new ResponseMsg<>(vulnerabilityService.deleteAppVulnerability(name, version, vulName));
    }


    @ApiOperation("查看某个漏洞的详细信息")
    @GetMapping("/getCveById")
    public ResponseMsg<CveDO> getCveById(@RequestParam String cveId) {
        return new ResponseMsg<>(vulnerabilityService.findCveById(cveId));
    }

    @ApiOperation("查看某个漏洞类型的详细信息")
    @GetMapping("/getCweById")
    public ResponseMsg<CweDO> getCweById(@RequestParam String cweId) {
        return new ResponseMsg<>(vulnerabilityService.findCweById(cweId));
    }
}
